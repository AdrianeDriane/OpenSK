// -----------------------------------------------------
// GENERATORS & DATASOURCE
// -----------------------------------------------------
generator client {
  provider   = "prisma-client"
  output     = "./generated"
}

datasource db {
  provider = "postgresql"
}

// -----------------------------------------------------
// LOOKUP TABLES
// -----------------------------------------------------

model Role {
  id    Int     @id @default(autoincrement())
  name  String  @unique

  users User[]
}

model VerificationRequestStatus {
  id    Int     @id @default(autoincrement())
  name  String  @unique

  requests VerificationRequest[]
}

model DocumentType {
  id    Int     @id @default(autoincrement())
  name  String  @unique

  documents Document[]
}

model InquiryStatus {
  id    Int     @id @default(autoincrement())
  name  String  @unique

  inquiries Inquiry[]
}

model VerificationRequestDocumentType {
  id   Int     @id @default(autoincrement())
  name String  @unique

  documents VerificationRequestDocuments[]
}

model AuditEntity {
  id    Int    @id @default(autoincrement())
  name  String @unique

  auditLogs AuditLog[]
}

// -----------------------------------------------------
// MAIN TABLES
// -----------------------------------------------------

model Barangay {
  id        Int        @id @default(autoincrement())
  name      String
  slug      String     @unique
  createdAt DateTime?

  users       User[]
  theme       Theme?
  documents   Document[]
  inquiries   Inquiry[]
}

model User {
  id          Int      @id @default(autoincrement())
  firstName   String
  lastName    String
  email       String   @unique
  verified    Boolean
  createdAt   DateTime?
  googleId    Int?     @unique

  roleId      Int
  barangayId  Int?

  role        Role      @relation(fields: [roleId], references: [id])
  barangay    Barangay? @relation(fields: [barangayId], references: [id])

  // Relations
  verificationRequests       VerificationRequest[]          @relation("UserRequests")
  verificationReviews        VerificationRequest[]          @relation("UserReviewed")
  documents                  Document[]
  inquiriesResponded         Inquiry[]                      @relation("RespondedBy")
  auditLogs                  AuditLog[]
}

model VerificationRequest {
  id          Int       @id @default(autoincrement())
  remarks     String?
  submittedAt DateTime?
  reviewedAt  DateTime?

  userId      Int
  statusId    Int
  reviewedBy  Int?

  // Relations
  user        User      @relation("UserRequests", fields: [userId], references: [id])
  status      VerificationRequestStatus @relation(fields: [statusId], references: [id])
  reviewer    User?     @relation("UserReviewed", fields: [reviewedBy], references: [id])

  documents   VerificationRequestDocuments[]
}

model VerificationRequestDocuments {
  id        Int      @id @default(autoincrement())
  fileUrl   String

  requestId Int
  typeId    Int

  request   VerificationRequest             @relation(fields: [requestId], references: [id])
  type      VerificationRequestDocumentType @relation(fields: [typeId], references: [id])
}

model Theme {
  id         Int      @id @default(autoincrement())
  config     Json
  updatedAt  DateTime?

  barangayId Int     @unique
  barangay   Barangay @relation(fields: [barangayId], references: [id])
}

model Document {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  year        Int?
  fileUrl     String
  createdAt   DateTime?

  barangayId  Int
  uploadedBy  Int
  typeId      Int

  barangay    Barangay    @relation(fields: [barangayId], references: [id])
  uploader    User        @relation(fields: [uploadedBy], references: [id])
  type        DocumentType @relation(fields: [typeId], references: [id])
}

model Inquiry {
  id              Int      @id @default(autoincrement())
  senderLastName  String?
  senderFirstName String?
  senderEmail     String?
  subject         String
  message         String
  createdAt       DateTime?
  responseMessage String?

  barangayId  Int
  statusId    Int
  respondedBy Int?

  barangay    Barangay      @relation(fields: [barangayId], references: [id])
  status      InquiryStatus @relation(fields: [statusId], references: [id])
  responder   User?         @relation("RespondedBy", fields: [respondedBy], references: [id])
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  action    String
  timestamp DateTime?

  userId    Int
  entityId  Int

  user      User        @relation(fields: [userId], references: [id])
  entity    AuditEntity @relation(fields: [entityId], references: [id])
}
